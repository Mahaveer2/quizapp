import{S as ye,i as we,s as ve,e as ue,b as z,d as D,f as W,g as k,h as w,I as ke,o as Ee,v as X,w as Te,k as E,q as B,a as C,l as T,m as x,r as H,c as P,n as v,G as f,H as le,y as Y,z as Z,A as ee,J as pe,K as me,L as Se,B as te,M as Ie,N as xe}from"../chunks/index.dedb3b4e.js";import{s as De,C as se}from"../chunks/sse.bbe8088b.js";import{p as qe}from"../chunks/stores.0330b986.js";function he(c,e,s){const t=c.slice();return t[14]=e[s],t}function Ce(c){let e,s,t,n,i;return{c(){e=E("a"),s=B("Login to Continue"),t=C(),n=E("p"),i=B("This is just a prototype of your requirements."),this.h()},l(a){e=T(a,"A",{href:!0,class:!0});var m=x(e);s=H(m,"Login to Continue"),m.forEach(w),t=P(a),n=T(a,"P",{});var r=x(n);i=H(r,"This is just a prototype of your requirements."),r.forEach(w),this.h()},h(){v(e,"href","/login"),v(e,"class","mt-[100px] p-3 flex justify-center items-center bg-black text-white")},m(a,m){z(a,e,m),f(e,s),z(a,t,m),z(a,n,m),f(n,i)},p:le,i:le,o:le,d(a){a&&w(e),a&&w(t),a&&w(n)}}}function Pe(c){let e,s,t,n,i,a,m,r,y,j,A,q,g,M,F,J,h,N,b,$,S,I,R,O,ne,G,ae,oe;M=new se({props:{type:"assistant",message:"Hello, ask me anything you want!"}});let V=c[3],u=[];for(let l=0;l<V.length;l+=1)u[l]=de(he(c,V,l));const be=l=>D(u[l],1,1,()=>{u[l]=null});let d=c[1]&&_e(c),_=c[2]&&ge();return{c(){e=E("div"),s=E("div"),t=E("a"),n=B("Take a test"),i=C(),a=E("h1"),m=B("Chatty"),r=C(),y=E("p"),j=B("Powered by gpt-3.5-turbo"),A=C(),q=E("div"),g=E("div"),Y(M.$$.fragment),F=C();for(let l=0;l<u.length;l+=1)u[l].c();J=C(),d&&d.c(),h=C(),_&&_.c(),N=C(),b=E("div"),$=C(),S=E("form"),I=E("input"),R=C(),O=E("button"),ne=B("Send"),this.h()},l(l){e=T(l,"DIV",{class:!0});var p=x(e);s=T(p,"DIV",{});var o=x(s);t=T(o,"A",{href:!0,class:!0});var U=x(t);n=H(U,"Take a test"),U.forEach(w),i=P(o),a=T(o,"H1",{class:!0});var ce=x(a);m=H(ce,"Chatty"),ce.forEach(w),r=P(o),y=T(o,"P",{class:!0});var ie=x(y);j=H(ie,"Powered by gpt-3.5-turbo"),ie.forEach(w),o.forEach(w),A=P(p),q=T(p,"DIV",{class:!0});var K=x(q);g=T(K,"DIV",{class:!0});var L=x(g);Z(M.$$.fragment,L),F=P(L);for(let re=0;re<u.length;re+=1)u[re].l(L);J=P(L),d&&d.l(L),h=P(L),_&&_.l(L),L.forEach(w),N=P(K),b=T(K,"DIV",{class:!0}),x(b).forEach(w),K.forEach(w),$=P(p),S=T(p,"FORM",{class:!0});var Q=x(S);I=T(Q,"INPUT",{type:!0,class:!0}),R=P(Q),O=T(Q,"BUTTON",{type:!0,class:!0});var fe=x(O);ne=H(fe,"Send"),fe.forEach(w),Q.forEach(w),p.forEach(w),this.h()},h(){v(t,"href","/test"),v(t,"class","mt-[100px] p-3 flex justify-center items-center bg-black text-white"),v(a,"class","text-2xl font-bold w-full text-center"),v(y,"class","text-sm italic"),v(g,"class","flex flex-col gap-2"),v(b,"class",""),v(q,"class","h-[500px] w-full bg-gray-900 rounded-md p-4 overflow-y-auto flex flex-col gap-4"),v(I,"type","text"),v(I,"class","input input-bordered w-full"),v(O,"type","submit"),v(O,"class","btn btn-accent"),v(S,"class","flex w-full rounded-md gap-4 bg-gray-900 p-4"),v(e,"class","flex flex-col pt-4 w-full px-8 items-center gap-2")},m(l,p){z(l,e,p),f(e,s),f(s,t),f(t,n),f(s,i),f(s,a),f(a,m),f(s,r),f(s,y),f(y,j),f(e,A),f(e,q),f(q,g),ee(M,g,null),f(g,F);for(let o=0;o<u.length;o+=1)u[o].m(g,null);f(g,J),d&&d.m(g,null),f(g,h),_&&_.m(g,null),f(q,N),f(q,b),c[7](b),f(e,$),f(e,S),f(S,I),pe(I,c[0]),f(S,R),f(S,O),f(O,ne),G=!0,ae||(oe=[me(I,"input",c[8]),me(S,"submit",Se(c[9]))],ae=!0)},p(l,p){if(p&8){V=l[3];let o;for(o=0;o<V.length;o+=1){const U=he(l,V,o);u[o]?(u[o].p(U,p),k(u[o],1)):(u[o]=de(U),u[o].c(),k(u[o],1),u[o].m(g,J))}for(X(),o=V.length;o<u.length;o+=1)be(o);W()}l[1]?d?(d.p(l,p),p&2&&k(d,1)):(d=_e(l),d.c(),k(d,1),d.m(g,h)):d&&(X(),D(d,1,1,()=>{d=null}),W()),l[2]?_?p&4&&k(_,1):(_=ge(),_.c(),k(_,1),_.m(g,null)):_&&(X(),D(_,1,1,()=>{_=null}),W()),p&1&&I.value!==l[0]&&pe(I,l[0])},i(l){if(!G){k(M.$$.fragment,l);for(let p=0;p<V.length;p+=1)k(u[p]);k(d),k(_),G=!0}},o(l){D(M.$$.fragment,l),u=u.filter(Boolean);for(let p=0;p<u.length;p+=1)D(u[p]);D(d),D(_),G=!1},d(l){l&&w(e),te(M),Ie(u,l),d&&d.d(),_&&_.d(),c[7](null),ae=!1,xe(oe)}}}function de(c){let e,s;return e=new se({props:{type:c[14].role,message:c[14].content}}),{c(){Y(e.$$.fragment)},l(t){Z(e.$$.fragment,t)},m(t,n){ee(e,t,n),s=!0},p(t,n){const i={};n&8&&(i.type=t[14].role),n&8&&(i.message=t[14].content),e.$set(i)},i(t){s||(k(e.$$.fragment,t),s=!0)},o(t){D(e.$$.fragment,t),s=!1},d(t){te(e,t)}}}function _e(c){let e,s;return e=new se({props:{type:"assistant",message:c[1]}}),{c(){Y(e.$$.fragment)},l(t){Z(e.$$.fragment,t)},m(t,n){ee(e,t,n),s=!0},p(t,n){const i={};n&2&&(i.message=t[1]),e.$set(i)},i(t){s||(k(e.$$.fragment,t),s=!0)},o(t){D(e.$$.fragment,t),s=!1},d(t){te(e,t)}}}function ge(c){let e,s;return e=new se({props:{type:"assistant",message:"Loading.."}}),{c(){Y(e.$$.fragment)},l(t){Z(e.$$.fragment,t)},m(t,n){ee(e,t,n),s=!0},i(t){s||(k(e.$$.fragment,t),s=!0)},o(t){D(e.$$.fragment,t),s=!1},d(t){te(e,t)}}}function je(c){let e,s,t,n;const i=[Pe,Ce],a=[];function m(r,y){return r[5].data.user?0:1}return e=m(c),s=a[e]=i[e](c),{c(){s.c(),t=ue()},l(r){s.l(r),t=ue()},m(r,y){a[e].m(r,y),z(r,t,y),n=!0},p(r,[y]){let j=e;e=m(r),e===j?a[e].p(r,y):(X(),D(a[j],1,1,()=>{a[j]=null}),W(),s=a[e],s?s.p(r,y):(s=a[e]=i[e](r),s.c()),k(s,1),s.m(t.parentNode,t))},i(r){n||(k(s),n=!0)},o(r){D(s),n=!1},d(r){a[e].d(r),r&&w(t)}}}function Me(c,e,s){let t;ke(c,qe,h=>s(5,t=h));let n="",i="",a=!1,m=[],r;function y(){setTimeout(function(){r.scrollIntoView({behavior:"smooth",block:"end",inline:"nearest"}),s(4,r.scrollTop=r.scrollHeight,r)},100)}const j=async()=>{const h=new FormData;h.append("studentId",t.data.user.userId);let b=await(await fetch("/api/chat/get",{method:"POST",body:h})).json();const $=b.data.map(I=>[{role:"user",content:I.prompt},{role:"assistant",content:I.returnMsg}].map(({role:R,content:O})=>({role:R,content:O}))),S=[].concat(...$);return s(3,m=[...m,...S]),b},A=async(h,N)=>{let b=new FormData;b.append("prompt",h),b.append("answer",N),b.append("id",t.data.user.userId),await fetch("/api/chat/add",{method:"POST",body:b})},q=async()=>{s(2,a=!0),s(3,m=[...m,{role:"user",content:n}]);const h=new De.SSE("/api/chat",{headers:{"Content-Type":"application/json"},payload:JSON.stringify({messages:m})});h.addEventListener("error",g),h.addEventListener("message",async N=>{y();try{if(s(2,a=!1),N.data==="[DONE]"){s(3,m=[...m,{role:"assistant",content:i}]);let S=await A(n,i);s(1,i=""),s(0,n="");return}const b=JSON.parse(N.data),[{delta:$}]=b.choices;$.content&&s(1,i=(i??"")+$.content)}catch(b){g(b)}}),h.stream(),y()};function g(h){s(2,a=!1),s(0,n=""),s(1,i=""),console.error(h)}Ee(async()=>{t.data.user&&j(),y()});function M(h){Te[h?"unshift":"push"](()=>{r=h,s(4,r)})}function F(){n=this.value,s(0,n)}return[n,i,a,m,r,t,q,M,F,()=>q()]}class Le extends ye{constructor(e){super(),we(this,e,Me,je,ve,{})}}export{Le as default};
